### 矩阵分解硬件加速毕设研究方向总结

#### 1. 现有 $LU$ 分解硬件加速设计的不完善之处分析

| **维度**            | **现有设计不足 (Unsoundness)**                               |
| ------------------- | ------------------------------------------------------------ |
| **算法/数值稳定性** | 大多设计为追求吞吐量而**省略或简化了 Partial Pivoting**，导致数值稳定性差。 |
| **架构/I/O 瓶颈**   | 处理大型矩阵时，数据在**片外 DDR** 中存储，**数据传输延迟**成为性能瓶颈。 |
| **架构/PE 利用率**  | 脉动阵列在 $LU$ 分解的**尾部迭代**或**非规整子矩阵**处理时，PE 利用率低。 |
| **算法/稀疏性**     | 难以在硬件上高效处理**动态 Fill-in** 导致的内存分配和不规则数据流。 |
| **精度/通用性**     | 倾向于使用低精度（如 FP32）以提高能效，但牺牲了科学计算所需的**高精度 (FP64)**。 |

---

#### 2. 核心毕设创新方向及技术细节

##### 🎯 方向一：高数值稳定性 $LU$ 硬件加速器 (集成低延迟 Pivoting)

**核心挑战：** 主元搜索是串行操作，引入显著延迟，中断并行计算流水线。

| **创新方向**               | **改进思路/技术细节**                                        |
| -------------------------- | ------------------------------------------------------------ |
| **流水线化 Pivoting 机制** | 设计**独立且深度流水线化**的 Pivoting 硬件模块。该模块**提前**开始下一列的主元搜索，并与当前列的矩阵更新**并行执行**。 |
| **高效行交换逻辑**         | 优化**行映射表的硬件设计**。使用**双端口 BRAM** 实现低延迟查找表，并通过**地址转换单元 (ATU)** 在数据送入 PE 阵列前快速完成行索引转换，隐藏行交换开销。 |
| **混合策略 Pivoting**      | 结合 **CPU 静态预排序 (COLAMD)** 和 **FPGA 动态 Pivoting**，减少运行时硬件主元搜索的频率。 |

##### 🧱 方向二：动态稀疏 $LU$ 加速架构 (Fill-in 内存管理)

**核心挑战：** Fill-in 动态改变矩阵结构，导致硬件难以在运行时高效分配和管理内存，访存不规则且效率低。

| **创新方向**                        | **改进思路/技术细节**                                        |
| ----------------------------------- | ------------------------------------------------------------ |
| **硬件加速的 Fill-in 管理器 (FMU)** | 设计专用的 **Fill-in 管理单元 (FMU)**，在 $LU$ 分解时**实时追踪 Fill-in**。使用**硬件哈希映射**或**链表管理**，实现**高效的动态内存分配**和新非零元素的插入。 |
| **稀疏脉动阵列优化**                | 提出适用于 $LU$ 分解的**半结构化稀疏格式**。设计**可跳过零元素**的 PE 阵列和数据流，确保只有非零计算才能激活 PE，提高计算利用率。 |
| **数据/计算解耦架构**               | 采用**令牌数据流 (Token Dataflow)** 架构，通过**临界性驱动 (Criticality-driven)** 的调度器，处理稀疏计算图中的**不规则并行性**和**长依赖链**，减少整体延迟。 |

---

#### 3. 目前我的想法

我目前总体参考了NUMPS求解大型稀疏矩阵的求解方法。在具体实现时我主要分为软件和硬件(目前平台为FPGA，FPGA上已经部署了一个简易的CPU、一个简易TPU(可以实现矩阵向量乘法、加法等)和一个简单的MMU)。但最后具体的实现并没有确定是目标是稀疏矩阵还是稠密矩阵或者两者都能支持。下面先以大型稀疏矩阵作为例子来描述我目前思考的整体架构

**软件部分**：软件部分我想参考NUMPS中的分析阶段：预排序、消解树的生成和符号分解。在自己的电脑上将完成对大型稀疏矩阵的分析阶段。在得到分解树以及符号分解后对分解结果矩阵的内存须有后，再将这些信息发送给硬件。

**硬件部分**：

首先我想做一个固件来做消解树的管理及按照消解树来进行调度整体算法的运行。具体的LU分解算法则是优先考虑Block LU分解。根据多波前法来一步一步得到分解好的矩阵。

同时硬件还负责矩阵的求解。在分解好矩阵以后，硬件还负责前向代换和后向代换来求解方程

---

#### 4. 遇到的问题

我目前遇到的问题如下：

1. 该毕设的创新点在哪里，上面提到**集成低延迟 Pivoting**的似乎可以加入。而fill-in的那部分我已经交给软件来处理，因此不会再硬件上添加相应的模块
2. 大型矩阵的分解和求解，会涉及到多次访存，设计更好的内存结构是否是一个较好的创新点，我该如何设计整个内存结构，达到一定的负载均衡
3. 因为我的求解器还有一个应用方向就是矩阵求逆。从矩阵求逆的角度，似乎QR分解更适合，但多波前方法进行QR分解十分复杂。这点我是否需要考虑QR分解。
4. 对于输入的稠密矩阵，似乎不需要进行消解树管理，因此在软件层还需要对矩阵类型进行判断。（ps:因为对于正定矩阵，我们可以进行$LDL^T$分解。因此软件层需要的判断较多）
5. 目前我并没有一个很清晰的架构图，包括软件应该包含哪些部分，硬件应该包含哪些部分。他们内部如何交互，他们之间如何交互。
6. 硬件内部各个模块的交互是否考虑引入总线？
7. 在这么多模块中，是否存在一些模块可以考虑异步性
8. 是否需要再设计一个脉动阵列来匹配整体的矩阵求解。(矩阵乘法等已经可以在简易的TPU上运行)

---

#### 5.需要你做的事情

希望你从一个TPU设计专家的身份，理性深度地剖析我的设计以及我的问题。如果遇到逻辑以及只知识不正确的情况，要立即指出，确保整体架构设计的合理性和严谨性以及正确性。请你仔细阅读这份文档，以及查阅相关文献(关键词为：矩阵求解/分解  TPU CPU GPU FPGA)。我列出的创新点只是我浅薄的想法，你可以列出更加有效的创新点。以及你需要做一下事情：

1. 请给我的毕设想几个题目

2. 分析我架构设计的合理性和严谨性和正确性，如果有不对的地方请立即指出，因为这也是我的初步方案。我有足够的时间修改

3. 尽可能的回答我遇到的问题，如果我的问题描述不清晰，请你提出，我可以重新描述。如果我的问题很naive，也请回答，因为我对整体TPU和矩阵分解也是刚入门。

4. 还需要考虑工作量，对我的整体工作进行分解

5. 给我的开题PPT提供一些大纲和内容

   







